

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Ghost Scripts &mdash; Claranet Cloud Deploy Release 17.11 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/ghost-doc.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="Claranet Cloud Deploy Release 17.11 documentation" href="../index.html"/>
        <link rel="next" title="Ghost Best Practices" href="bestpractices.html"/>
        <link rel="prev" title="Cloud Deploy Commands" href="commands.html"/>


  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> Claranet Cloud Deploy
          

          
            
            <img src="../_static/logo_cloud_deploy.png" class="logo" />
          
          </a>

          
            
            
              <div class="version">
                17.11
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="quick-start.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="resources.html">Ghost Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">Ghost API</a></li>
<li class="toctree-l1"><a class="reference internal" href="commands.html">Cloud Deploy Commands</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Ghost Scripts</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#id1">Scripts</a></li>
<li class="toctree-l2"><a class="reference internal" href="#environment-variables">Environment variables</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="bestpractices.html">Ghost Best Practices</a></li>
<li class="toctree-l1"><a class="reference internal" href="ui.html">Web User Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli.html">Casper: CLI client</a></li>
<li class="toctree-l1"><a class="reference internal" href="bluegreen.html">Blue/Green Deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="container.html">Deployment With Buildpack Execution in Container</a></li>
<li class="toctree-l1"><a class="reference internal" href="matrix.html">Feature matrix comparison</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Ghost Changelog</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Claranet Cloud Deploy</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Ghost Scripts</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/rst/scripts.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="ghost-scripts">
<span id="scripts"></span><h1>Ghost Scripts<a class="headerlink" href="#ghost-scripts" title="Permalink to this headline">¶</a></h1>
<div class="toctree-wrapper compound">
</div>
<div class="section" id="id1">
<h2>Scripts<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>Ghost enables you to launch custom scripts at every steps of the deployment and build process (bake image template).
Here is an overview and a description of thoses scripts.</p>
<blockquote>
<div><ul class="simple">
<li><strong>pre_buildimage</strong>: Script executed in the <cite>buildimage</cite> command before formulas provisioning. It allows you to prepare the source AMI before the execution of all of your application’s features formulas. It can be usefull in order to change package’s mirrors location for example.</li>
<li><strong>post_buildimage</strong>: Script executed in the <cite>buildimage</cite> command after formulas provisioning. You can tweak and install custom system packages after the features provisioning.</li>
</ul>
<div class="figure">
<img alt="../_images/buildimage_workflow.png" src="../_images/buildimage_workflow.png" />
</div>
<ul class="simple">
<li><strong>pre_bootstrap</strong>: Script executed when a new instance starts, before the deployment of modules packages.</li>
<li><strong>post_bootstrap</strong>: Script executed when a new instance starts, after the deployment of modules packages. It can be used to verify and validate the whole instance deployment.</li>
</ul>
<div class="figure">
<img alt="../_images/bootstrap_workflow.png" src="../_images/bootstrap_workflow.png" />
</div>
<ul class="simple">
<li><strong>buildpack</strong>: Script executed on Ghost when deploying a new version of a module (new package). This script will prepare the git repository before making the archive package which will be pushed on S3. Every external dependencies required by the application <strong>must</strong> be resolved in this script.</li>
<li><strong>pre_deploy</strong>: Script executed on every instance when deploying a module package. This script will prepare the target instance <em>before</em> symbolic link swap. This script <strong>must not</strong> depend on external resources (no internet call, no package install, no downloads).</li>
<li><strong>post_deploy</strong>: Script executed on every instance when deploying a module package. This script will prepare the target instance <em>after</em> symbolic link swap. This script <strong>must not</strong> depend on external resources (no internet call, no package install, no downloads).</li>
<li><strong>after_all_deploy</strong>: Script executed on Ghost when deploying a new version of a module (new package). This script is executed after the package deployment on every instance of the current application.</li>
</ul>
<div class="figure">
<img alt="../_images/deploy_workflow.png" src="../_images/deploy_workflow.png" />
</div>
<ul class="simple">
<li><strong>pre_swap</strong>: Script executed in the <cite>swapbluegreen</cite> command <em>before</em> swapping the two environments in this order: active application, inactive application. Scripts of both application are ran. This script is executed on the Cloud Deploy instance and not application instances. See <a class="reference internal" href="commands.html#cmd-swapbluegreen"><span class="std std-ref">Blue/Green | swapbluegreen</span></a> for more details.</li>
<li><strong>post_swap</strong>: Script executed in the <cite>swapbluegreen</cite> command <em>after</em> swapping the two environments in this order: newly inactive application, newly active application. Scripts of both application are ran. This script is executed on the Cloud Deploy instance and not application instances. See <a class="reference internal" href="commands.html#cmd-swapbluegreen"><span class="std std-ref">Blue/Green | swapbluegreen</span></a> for more details.</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="environment-variables">
<span id="scripts-vars"></span><h2>Environment variables<a class="headerlink" href="#environment-variables" title="Permalink to this headline">¶</a></h2>
<p>When custom scripts and binaries are triggered in the Ghost deployment workflow, many variables are available in the environment to help you making generic scripts.
It’s also possible to define custom variables which will be configured within the Ghost server environment and therefore available when running scripts over instances.</p>
<table border="1" class="docutils">
<colgroup>
<col width="12%" />
<col width="19%" />
<col width="7%" />
<col width="7%" />
<col width="6%" />
<col width="7%" />
<col width="5%" />
<col width="5%" />
<col width="6%" />
<col width="8%" />
<col width="7%" />
<col width="5%" />
<col width="6%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Variables</th>
<th class="head">Purpose</th>
<th class="head">pre_buildimage</th>
<th class="head">post_buildimage</th>
<th class="head">pre_bootstrap</th>
<th class="head">post_bootstrap</th>
<th class="head">buildpack</th>
<th class="head">pre_deploy</th>
<th class="head">post_deploy</th>
<th class="head">after_all_deploy</th>
<th class="head">execute_script</th>
<th class="head">pre_swap</th>
<th class="head">post_swap</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>GHOST_APP</td>
<td>Application name</td>
<td>✔</td>
<td>✔</td>
<td>✔</td>
<td>✔</td>
<td>✔</td>
<td>✔</td>
<td>✔</td>
<td>✔</td>
<td>✔</td>
<td>✔</td>
<td>✔</td>
</tr>
<tr class="row-odd"><td>GHOST_ENV</td>
<td>Application environment</td>
<td>✔</td>
<td>✔</td>
<td>✔</td>
<td>✔</td>
<td>✔</td>
<td>✔</td>
<td>✔</td>
<td>✔</td>
<td>✔</td>
<td>✔</td>
<td>✔</td>
</tr>
<tr class="row-even"><td>GHOST_ENV_COLOR</td>
<td>Application color if Blue/Green enabled</td>
<td>✔</td>
<td>✔</td>
<td>✔</td>
<td>✔</td>
<td>✔</td>
<td>✔</td>
<td>✔</td>
<td>✔</td>
<td>✔</td>
<td>✔</td>
<td>✔</td>
</tr>
<tr class="row-odd"><td>GHOST_ACTIVE_COLOR</td>
<td>Current active color if Blue/Green enabled</td>
<td>✔</td>
<td>✔</td>
<td>✔</td>
<td>✔</td>
<td>✔</td>
<td>✔</td>
<td>✔</td>
<td>✔</td>
<td>✔</td>
<td>✔</td>
<td>✔</td>
</tr>
<tr class="row-even"><td>GHOST_ROLE</td>
<td>Application role</td>
<td>✔</td>
<td>✔</td>
<td>✔</td>
<td>✔</td>
<td>✔</td>
<td>✔</td>
<td>✔</td>
<td>✔</td>
<td>✔</td>
<td>✔</td>
<td>✔</td>
</tr>
<tr class="row-odd"><td>GHOST_MODULE_NAME</td>
<td>Module name</td>
<td>&#160;</td>
<td>&#160;</td>
<td>&#160;</td>
<td>&#160;</td>
<td>✔</td>
<td>✔</td>
<td>✔</td>
<td>✔</td>
<td>~</td>
<td>&#160;</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>GHOST_MODULE_PATH</td>
<td>Module destination path</td>
<td>&#160;</td>
<td>&#160;</td>
<td>&#160;</td>
<td>&#160;</td>
<td>✔</td>
<td>✔</td>
<td>✔</td>
<td>✔</td>
<td>~</td>
<td>&#160;</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>GHOST_MODULE_REPO</td>
<td>Module git repository</td>
<td>&#160;</td>
<td>&#160;</td>
<td>&#160;</td>
<td>&#160;</td>
<td>✔</td>
<td>✔</td>
<td>✔</td>
<td>✔</td>
<td>~</td>
<td>&#160;</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>GHOST_MODULE_REV</td>
<td>Module git revision deployed</td>
<td>&#160;</td>
<td>&#160;</td>
<td>&#160;</td>
<td>&#160;</td>
<td>✔</td>
<td>✔</td>
<td>✔</td>
<td>✔</td>
<td>&#160;</td>
<td>&#160;</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>GHOST_MODULE_COMMIT</td>
<td>Module git commit hash deployed</td>
<td>&#160;</td>
<td>&#160;</td>
<td>&#160;</td>
<td>&#160;</td>
<td>✔</td>
<td>✔</td>
<td>✔</td>
<td>✔</td>
<td>&#160;</td>
<td>&#160;</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>GHOST_MODULE_COMMIT_MESSAGE</td>
<td>Module git commit message</td>
<td>&#160;</td>
<td>&#160;</td>
<td>&#160;</td>
<td>&#160;</td>
<td>✔</td>
<td>✔</td>
<td>✔</td>
<td>✔</td>
<td>&#160;</td>
<td>&#160;</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>GHOST_MODULE_USER</td>
<td>User who triggered the deployment</td>
<td>&#160;</td>
<td>&#160;</td>
<td>&#160;</td>
<td>&#160;</td>
<td>✔</td>
<td>✔</td>
<td>✔</td>
<td>✔</td>
<td>✔</td>
<td>&#160;</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td><em>custom var</em></td>
<td>Defined by user in Ghost App</td>
<td>✔</td>
<td>✔</td>
<td>✔</td>
<td>✔</td>
<td>✔</td>
<td>✔</td>
<td>✔</td>
<td>✔</td>
<td>✔</td>
<td>✔</td>
<td>✔</td>
</tr>
</tbody>
</table>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="bestpractices.html" class="btn btn-neutral float-right" title="Ghost Best Practices" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="commands.html" class="btn btn-neutral" title="Cloud Deploy Commands" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Claranet Cloud Practice.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'Release 17.11',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>